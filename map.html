<!DOCTYPE html>
<html lang="r">
<html>
    <head>
        <title>
            Admin Panel
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="styles/global.css"/>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyBkeK3tGZsylTsJTp8YDOTWYib2q9zsDdQ",
                authDomain: "gps-tracker-220118.firebaseapp.com",
                databaseURL: "https://gps-tracker-220118.firebaseio.com",
                projectId: "gps-tracker-220118",
                storageBucket: "gps-tracker-220118.appspot.com",
                messagingSenderId: "518213220283"
            };
            firebase.initializeApp(config);
        </script>

        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
        <style>
            body { margin:0; padding:0; }
            #map {height: 100%; width: auto; }
        </style>

        <script src="scripts/jquery-3.3.1.min.js"></script>
        <script src="scripts/script.js" type="text/javascript">


        </script>
    </head>

    <body>
        <div id="header">
            <div class="logo">
                <a href="#">
                    Grand<span>Alem</span>
                </a>
            </div>
        </div>
        <div id="container">
            <div class="sidebar">
                <ul id="nav">
                    <li><a class="selected" href="index.html">Dashboard</a></li>
                    <li><a href="map.html">Карта</a></li>
                    <li><a href="users.html">Пользователи</a></li>
                    <li><a href="#">Отзывы</a></li>
                </ul>
            </div>
            <div class="content">
                <!-- <h1>Карта</h1> -->

                <div id='map'></div>
                <script>
                mapboxgl.accessToken = 'pk.eyJ1Ijoic2lnZW1peiIsImEiOiJjanFydWRpbGIwb3RxM3htdmRmMTVmdHhkIn0.zyq6Zode1A65qjir6wMLnw';
                var map = new mapboxgl.Map({
                    container: 'map', // container id
                    style: 'mapbox://styles/mapbox/streets-v9',
                    center: [71.41598, 51.1101], // starting position
                    zoom: 12 // starting zoom
                });

                map.addControl(new mapboxgl.NavigationControl());

                var database = firebase.database();
                var ref = database.ref('driver-locations');

                ref.on('value', gotData, errData);

                var markers = new Array();
                for (var i = 0; i < 100; i++) {
                    var marker = new mapboxgl.Marker();
                    markers.push(marker);
                }

                function gotData(data) {
                    var driver_locations = data.val();
                    var it = 0;

                    for(var i = 0; i < 100; i++) {
                        markers[i].remove();
                    }

                    for (var key in driver_locations) {
                        if (driver_locations.hasOwnProperty(key)) {
                            var driver = driver_locations[key];
                            markers[it] = new mapboxgl.Marker().setLngLat([driver.longitude, driver.latitude]).addTo(map);
                            console.log(it)
                            it++;
                        }
                    }
                    //console.log(data.val());
                }

                function errData(err) {
                    console.log('Error');
                    console.log(err);
                }

                </script>



            </div>
        </div>
    </body>
</html>
